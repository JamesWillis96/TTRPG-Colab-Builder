{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jwillis8/Documents/TTRPG-Colab-Builder/app/sessions/%5Bid%5D/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport { useAuth } from '../../../contexts/AuthContext'\r\nimport { supabase } from '../../../lib/supabase'\r\nimport { useParams, useRouter } from 'next/navigation'\r\n\r\ntype Session = {\r\n  id: string\r\n  title: string\r\n  description: string\r\n  date_time: string\r\n  max_players: number\r\n  gm_id: string\r\n  status: string\r\n  created_at: string\r\n}\r\n\r\ntype Profile = {\r\n  id: string\r\n  username: string\r\n  role: string\r\n}\r\n\r\ntype Signup = {\r\n  id:  string\r\n  session_id: string\r\n  player_id: string\r\n  signed_up_at: string\r\n  profile?:  Profile\r\n}\r\n\r\nexport default function SessionDetailPage() {\r\n  const { user } = useAuth()\r\n  const params = useParams()\r\n  const router = useRouter()\r\n  const sessionId = params.id as string\r\n\r\n  const [session, setSession] = useState<Session | null>(null)\r\n  const [signups, setSignups] = useState<Signup[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n  const [isGM, setIsGM] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (sessionId) {\r\n      loadSession()\r\n    }\r\n  }, [sessionId])\r\n\r\n  const loadSession = async () => {\r\n    setLoading(true)\r\n    \r\n    try {\r\n      // 1. Load session details\r\n      const { data: sessionData, error:  sessionError } = await supabase\r\n        .from('sessions')\r\n        .select('*')\r\n        .eq('id', sessionId)\r\n        .single()\r\n\r\n      if (sessionError) throw sessionError\r\n      \r\n      setSession(sessionData)\r\n      setIsGM(user?.id === sessionData.gm_id)\r\n\r\n      // 2. Load signups\r\n      const { data: signupsData, error: signupsError } = await supabase\r\n        .from('session_signups')\r\n        .select('*')\r\n        .eq('session_id', sessionId)\r\n        .order('signed_up_at', { ascending: true })\r\n\r\n      if (signupsError) throw signupsError\r\n\r\n      if (! signupsData || signupsData.length === 0) {\r\n        setSignups([])\r\n        return\r\n      }\r\n\r\n      // 3. Load profiles for all signed up players\r\n      const playerIds = signupsData.map(s => s.player_id)\r\n      const { data: profilesData, error:  profilesError } = await supabase\r\n        .from('profiles')\r\n        .select('*')\r\n        .in('id', playerIds)\r\n\r\n      if (profilesError) throw profilesError\r\n\r\n      // 4. Combine signups with profiles\r\n      const signupsWithProfiles:  Signup[] = signupsData.map(signup => ({\r\n        id: signup.id,\r\n        session_id: signup.session_id,\r\n        player_id: signup.player_id,\r\n        signed_up_at: signup.signed_up_at,\r\n        profile: profilesData?.find(p => p.id === signup.player_id)\r\n      }))\r\n\r\n      setSignups(signupsWithProfiles)\r\n\r\n    } catch (error:  any) {\r\n      console.error('Error loading session:', error. message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleRemovePlayer = async (signupId: string) => {\r\n    if (! confirm('Are you sure you want to remove this player?')) return\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('session_signups')\r\n        .delete()\r\n        .eq('id', signupId)\r\n\r\n      if (error) throw error\r\n      await loadSession()\r\n    } catch (error: any) {\r\n      alert('Error removing player: ' + error.message)\r\n    }\r\n  }\r\n\r\n  const handleDeleteSession = async () => {\r\n    if (!confirm('Are you sure you want to delete this session?  This cannot be undone.')) return\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        . from('sessions')\r\n        .delete()\r\n        .eq('id', sessionId)\r\n\r\n      if (error) throw error\r\n      router.push('/sessions')\r\n    } catch (error: any) {\r\n      alert('Error deleting session:  ' + error.message)\r\n    }\r\n  }\r\n\r\n  const handleStatusChange = async (newStatus:  string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('sessions')\r\n        .update({ status: newStatus })\r\n        .eq('id', sessionId)\r\n\r\n      if (error) throw error\r\n      await loadSession()\r\n    } catch (error: any) {\r\n      alert('Error updating status: ' + error.message)\r\n    }\r\n  }\r\n\r\n  if (loading) {\r\n    return <div style={{ padding: '2rem', textAlign: 'center' }}>Loading... </div>\r\n  }\r\n\r\n  if (!session) {\r\n    return (\r\n      <div style={{ padding:  '2rem', textAlign: 'center' }}>\r\n        <p>Session not found</p>\r\n        <a href=\"/sessions\" style={{ color: '#4f8' }}>‚Üê Back to Sessions</a>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <main style={{ padding: '2rem', maxWidth: '900px', margin: '0 auto' }}>\r\n      <div style={{ marginBottom: '2rem' }}>\r\n        <a href=\"/sessions\" style={{ color:  '#4f8', textDecoration: 'none' }}>\r\n          ‚Üê Back to Sessions\r\n        </a>\r\n      </div>\r\n\r\n      <div style={{\r\n        background: '#111',\r\n        border: '1px solid #333',\r\n        borderRadius: '8px',\r\n        padding: '2rem'\r\n      }}>\r\n        {/* Header */}\r\n        <div style={{ marginBottom: '2rem' }}>\r\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start', marginBottom: '1rem' }}>\r\n            <h1 style={{ fontSize: '2rem' }}>{session.title}</h1>\r\n            {isGM && (\r\n              <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                <button\r\n                  onClick={() => router.push(`/sessions/${sessionId}/edit`)}\r\n                  style={{\r\n                    padding: '0.5rem 1rem',\r\n                    background: '#4f8',\r\n                    color:  '#000',\r\n                    border: 'none',\r\n                    borderRadius:  '4px',\r\n                    cursor: 'pointer',\r\n                    fontWeight: 'bold'\r\n                  }}\r\n                >\r\n                  Edit\r\n                </button>\r\n                <button\r\n                  onClick={handleDeleteSession}\r\n                  style={{\r\n                    padding: '0.5rem 1rem',\r\n                    background: '#ff000020',\r\n                    color: '#ff6666',\r\n                    border:  '1px solid #ff0000',\r\n                    borderRadius:  '4px',\r\n                    cursor: 'pointer'\r\n                  }}\r\n                >\r\n                  Delete\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {session.description && (\r\n            <p style={{ color: '#aaa', marginBottom: '1.5rem' }}>{session.description}</p>\r\n          )}\r\n\r\n          <div style={{ display: 'flex', gap: '2rem', flexWrap: 'wrap', marginBottom: '1rem' }}>\r\n            <div>\r\n              <span style={{ color: '#666' }}>üìÖ </span>\r\n              <span style={{ color: '#fff' }}>\r\n                {new Date(session.date_time).toLocaleDateString()}\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span style={{ color: '#666' }}>üë• </span>\r\n              <span style={{ color: '#fff' }}>\r\n                {signups.length} / {session.max_players} players\r\n              </span>\r\n            </div>\r\n            <div>\r\n              <span style={{ color: '#666' }}>üìä </span>\r\n              <span style={{ \r\n                color: session.status === 'open' ? '#4f8' :  '#888',\r\n                textTransform: 'capitalize'\r\n              }}>\r\n                {session.status}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          {isGM && (\r\n            <div style={{ marginTop:  '1rem' }}>\r\n              <label style={{ display: 'block', marginBottom: '0.5rem', color: '#666', fontSize: '0.875rem' }}>\r\n                Change Status: \r\n              </label>\r\n              <select\r\n                value={session.status}\r\n                onChange={(e) => handleStatusChange(e.target. value)}\r\n                style={{\r\n                  padding: '0.5rem',\r\n                  background: '#222',\r\n                  border: '1px solid #444',\r\n                  borderRadius: '4px',\r\n                  color: '#fff'\r\n                }}\r\n              >\r\n                <option value=\"open\">Open</option>\r\n                <option value=\"full\">Full</option>\r\n                <option value=\"completed\">Completed</option>\r\n                <option value=\"cancelled\">Cancelled</option>\r\n              </select>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Divider */}\r\n        <div style={{ height: '1px', background: '#333', margin: '2rem 0' }}></div>\r\n\r\n        {/* Players List */}\r\n        <div>\r\n          <h2 style={{ fontSize:  '1.5rem', marginBottom: '1rem' }}>\r\n            Signed Up Players ({signups.length})\r\n          </h2>\r\n\r\n          {signups.length === 0 ? (\r\n            <p style={{ color: '#666', fontStyle: 'italic' }}>No players signed up yet. </p>\r\n          ) : (\r\n            <div style={{ display: 'grid', gap: '0.75rem' }}>\r\n              {signups.map((signup, index) => (\r\n                <div\r\n                  key={signup.id}\r\n                  style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    padding:  '1rem',\r\n                    background: '#0a0a0a',\r\n                    border: '1px solid #222',\r\n                    borderRadius: '4px'\r\n                  }}\r\n                >\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: '1rem' }}>\r\n                    <span style={{ \r\n                      color: '#666', \r\n                      fontSize: '1. 25rem',\r\n                      fontWeight: 'bold',\r\n                      minWidth: '2rem'\r\n                    }}>\r\n                      {index + 1}. \r\n                    </span>\r\n                    <div>\r\n                      <div style={{ fontWeight: 'bold', color: '#fff' }}>\r\n                        {signup.profile?.username || 'Unknown User'}\r\n                      </div>\r\n                      <div style={{ fontSize:  '0.875rem', color: '#666' }}>\r\n                        Signed up:  {new Date(signup.signed_up_at).toLocaleDateString()}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {isGM && (\r\n                    <button\r\n                      onClick={() => handleRemovePlayer(signup.id)}\r\n                      style={{\r\n                        padding: '0.25rem 0.75rem',\r\n                        background: '#ff000020',\r\n                        color: '#ff6666',\r\n                        border: '1px solid #ff000060',\r\n                        borderRadius: '4px',\r\n                        cursor:  'pointer',\r\n                        fontSize: '0.875rem'\r\n                      }}\r\n                    >\r\n                      Remove\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </main>\r\n  )\r\n}"],"names":[],"mappings":"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"}}]
}