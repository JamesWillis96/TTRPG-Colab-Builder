{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jwillis8/Documents/TTRPG-Colab-Builder/app/sessions/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport { useAuth } from '../../contexts/AuthContext'\r\nimport { supabase } from '../../lib/supabase'\r\nimport { useRouter } from 'next/navigation'\r\n\r\ntype Session = {\r\n  id: string\r\n  title: string\r\n  description:  string\r\n  date_time: string\r\n  max_players: number\r\n  gm_id: string\r\n  status: string\r\n  created_at: string\r\n  signups?:  any[]\r\n}\r\n\r\nexport default function SessionsPage() {\r\n  const { user } = useAuth()\r\n  const router = useRouter()\r\n  const [sessions, setSessions] = useState<Session[]>([])\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  useEffect(() => {\r\n    loadSessions()\r\n  }, [])\r\n\r\n  const loadSessions = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('sessions')\r\n        .select(`\r\n          *,\r\n          signups: session_signups(player_id)\r\n        `)\r\n        .order('date_time', { ascending:  true })\r\n\r\n      if (error) throw error\r\n      setSessions(data || [])\r\n    } catch (error:  any) {\r\n      console.error('Error loading sessions:', error. message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  const handleSignup = async (sessionId: string) => {\r\n    if (!user) {\r\n      router.push('/login')\r\n      return\r\n    }\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('session_signups')\r\n        .insert({ session_id: sessionId, player_id: user.id })\r\n\r\n      if (error) throw error\r\n      \r\n      // Reload sessions to show updated signup\r\n      loadSessions()\r\n    } catch (error: any) {\r\n      alert('Error signing up: ' + error.message)\r\n    }\r\n  }\r\n\r\n  const handleCancelSignup = async (sessionId: string) => {\r\n    if (!user) return\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('session_signups')\r\n        .delete()\r\n        .eq('session_id', sessionId)\r\n        .eq('player_id', user.id)\r\n\r\n      if (error) throw error\r\n      \r\n      // Reload sessions to show updated signup\r\n      loadSessions()\r\n    } catch (error: any) {\r\n      alert('Error cancelling signup: ' + error.message)\r\n    }\r\n  }\r\n\r\n  const isSignedUp = (session: Session) => {\r\n    if (!user || !session.signups) return false\r\n    return session.signups.some((signup: any) => signup.player_id === user.id)\r\n  }\r\n\r\n  const isFull = (session: Session) => {\r\n    return session.signups && session.signups.length >= session.max_players\r\n  }\r\n\r\n  if (loading) {\r\n    return <div style={{ padding: '2rem', textAlign: 'center' }}>Loading sessions...</div>\r\n  }\r\n\r\n  return (\r\n    <main style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem' }}>\r\n        <h1 style={{ fontSize: '2.5rem' }}>Game Sessions</h1>\r\n        {user && (\r\n          <a\r\n            href=\"/sessions/create\"\r\n            style={{\r\n              padding: '0.75rem 1.5rem',\r\n              background: '#4f8',\r\n              color: '#000',\r\n              textDecoration: 'none',\r\n              borderRadius:  '4px',\r\n              fontWeight: 'bold'\r\n            }}\r\n          >\r\n            + Create Session\r\n          </a>\r\n        )}\r\n      </div>\r\n\r\n      {sessions.length === 0 ?  (\r\n        <div style={{ \r\n          textAlign: 'center', \r\n          padding: '3rem', \r\n          background: '#111', \r\n          borderRadius: '8px',\r\n          border: '1px solid #333'\r\n        }}>\r\n          <p style={{ fontSize: '1.25rem', color: '#888' }}>No sessions scheduled yet. </p>\r\n          {user && (\r\n            <p style={{ marginTop: '1rem', color: '#666' }}>\r\n              Be the first to create one! \r\n            </p>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div style={{ display: 'grid', gap: '1.5rem' }}>\r\n          {sessions.map((session) => {\r\n            const signedUp = isSignedUp(session)\r\n            const full = isFull(session)\r\n            const signupCount = session.signups?. length || 0\r\n\r\n            return (\r\n              <div\r\n                key={session.id}\r\n                style={{\r\n                  background: '#111',\r\n                  border: '1px solid #333',\r\n                  borderRadius: '8px',\r\n                  padding: '1.5rem'\r\n                }}\r\n              >\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'start' }}>\r\n                  <div style={{ flex: 1 }}>\r\n                    <h2 style={{ fontSize: '1.5rem', marginBottom: '0.5rem' }}>\r\n                        <a \r\n                            href={`/sessions/${session.id}`}\r\n                            style={{ color: '#fff', textDecoration: 'none' }}\r\n                        >\r\n                            {session.title}\r\n                        </a>\r\n                    </h2>\r\n                    <p style={{ color: '#888', marginBottom: '1rem' }}>\r\n                      {session.description}\r\n                    </p>\r\n                    <div style={{ display: 'flex', gap: '2rem', flexWrap: 'wrap' }}>\r\n                      <div>\r\n                        <span style={{ color: '#666' }}>ðŸ“… </span>\r\n                        <span style={{ color: '#aaa' }}>\r\n                            {new Date(session.date_time).toLocaleDateString()}</span>\r\n                      </div>\r\n                      <div>\r\n                        <span style={{ color: '#666' }}>ðŸ‘¥ </span>\r\n                        <span style={{ color: full ? '#f84' : '#4f8' }}>\r\n                          {signupCount} / {session.max_players} players\r\n                        </span>\r\n                      </div>\r\n                      <div>\r\n                        <span style={{ color: '#666' }}>ðŸ“Š </span>\r\n                        <span style={{ \r\n                          color: session.status === 'open' ?  '#4f8' : '#888',\r\n                          textTransform: 'capitalize'\r\n                        }}>\r\n                          {session.status}\r\n                        </span>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div style={{ marginLeft: '1rem' }}>\r\n                    {user ?  (\r\n                      signedUp ? (\r\n                        <button\r\n                          onClick={() => handleCancelSignup(session.id)}\r\n                          style={{\r\n                            padding: '0.5rem 1rem',\r\n                            background:  '#ff000020',\r\n                            border: '1px solid #ff0000',\r\n                            borderRadius: '4px',\r\n                            color: '#ff6666',\r\n                            cursor: 'pointer',\r\n                            fontWeight: 'bold'\r\n                          }}\r\n                        >\r\n                          Cancel Signup\r\n                        </button>\r\n                      ) : full ? (\r\n                        <button\r\n                          disabled\r\n                          style={{\r\n                            padding: '0.5rem 1rem',\r\n                            background:  '#333',\r\n                            border: '1px solid #555',\r\n                            borderRadius: '4px',\r\n                            color:  '#666',\r\n                            cursor: 'not-allowed'\r\n                          }}\r\n                        >\r\n                          Session Full\r\n                        </button>\r\n                      ) : (\r\n                        <button\r\n                          onClick={() => handleSignup(session.id)}\r\n                          style={{\r\n                            padding: '0.5rem 1rem',\r\n                            background: '#4f8',\r\n                            border: 'none',\r\n                            borderRadius: '4px',\r\n                            color: '#000',\r\n                            cursor: 'pointer',\r\n                            fontWeight: 'bold'\r\n                          }}\r\n                        >\r\n                          Sign Up\r\n                        </button>\r\n                      )\r\n                    ) : (\r\n                      <a\r\n                        href=\"/login\"\r\n                        style={{\r\n                          padding: '0.5rem 1rem',\r\n                          background: '#333',\r\n                          border: '1px solid #555',\r\n                          borderRadius: '4px',\r\n                          color: '#aaa',\r\n                          textDecoration: 'none',\r\n                          display: 'inline-block'\r\n                        }}\r\n                      >\r\n                        Login to Sign Up\r\n                      </a>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )\r\n          })}\r\n        </div>\r\n      )}\r\n    </main>\r\n  )\r\n}"],"names":[],"mappings":"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"}}]
}